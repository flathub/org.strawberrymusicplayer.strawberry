app-id: org.strawberrymusicplayer.strawberry
runtime: org.kde.Platform
runtime-version: '6.2'
sdk: org.kde.Sdk
rename-icon: strawberry
command: strawberry
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/info
  - /share/man
  - /share/tagparser
  - /share/c++utilities
  - /bin/mmc-tool
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --filesystem=xdg-music
  - --filesystem=/mnt
  - --filesystem=/media
  - --filesystem=/run/media
  - --system-talk-name=org.freedesktop.Avahi
  - --talk-name=org.freedesktop.Notifications
  - --system-talk-name=org.freedesktop.UDisks2
  - --talk-name=org.gnome.SettingsDaemon.MediaKeys
  - --talk-name=org.wiimotedev.deviceEvents
  - --talk-name=org.mpris.MediaPlayer2.Player
  - --own-name=org.mpris.MediaPlayer2.strawberry
  - --talk-name=org.kde.StatusNotifierWatcher
  - --own-name=org.kde.StatusNotifierItem-2-2
modules:
  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix="${FLATPAK_DEST}"
      - ./b2 -j ${FLATPAK_BUILDER_N_JOBS}
      - ./b2 -j ${FLATPAK_BUILDER_N_JOBS} headers
      - ./b2 install
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.78.0/source/boost_1_78_0.tar.gz
        sha256: 94ced8b72956591c4775ae2207a9763d3600b30d9d7446562c552f0a14a63be7
        x-checker-data:
          type: anitya
          project-id: 6845
          url-template: https://boostorg.jfrog.io/artifactory/main/release/$version/source/boost_${version0}_${version1}_$version2.tar.gz
  - name: chromaprint
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/acoustid/chromaprint/releases/download/v1.5.1/chromaprint-1.5.1.tar.gz
        sha256: a1aad8fa3b8b18b78d3755b3767faff9abb67242e01b478ec9a64e190f335e1c
        x-checker-data:
          type: anitya
          project-id: 286
          url-template: https://github.com/acoustid/chromaprint/releases/download/v$version/chromaprint-$version.tar.gz
  - name: protobuf
    cleanup:
      - /bin/protoc
    sources:
      - type: archive
        url: https://github.com/protocolbuffers/protobuf/releases/download/v3.19.4/protobuf-cpp-3.19.4.tar.gz
        sha256: 89ac31a93832e204db6d73b1e80f39f142d5747b290f17340adce5be5b122f94
        x-checker-data:
          type: json
          url: https://api.github.com/repos/protocolbuffers/protobuf/releases/latest
          version-query: .tag_name |sub("v";"")
          url-query: .assets[] | select(.name=="protobuf-cpp-"+ $version +".tar.gz")
            | .browser_download_url
  - name: taglib
    buildsystem: cmake-ninja
    cleanup:
      - /bin/
    sources:
      - type: archive
        url: https://github.com/taglib/taglib/releases/download/v1.12/taglib-1.12.tar.gz
        sha256: 7fccd07669a523b07a15bd24c8da1bbb92206cb19e9366c3692af3d79253b703
  - name: libcdio
    config-opts:
      - --without-cd-drive
      - --without-cd-info
      - --without-cdda-player
      - --without-cd-read
      - --without-iso-info
      - --without-iso-read
      - --with-pic
      - --disable-static
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libcdio/libcdio-2.1.0.tar.bz2
        sha256: 8550e9589dbd594bfac93b81ecf129b1dc9d0d51e90f9696f1b2f9b2af32712b
        x-checker-data:
          type: anitya
          project-id: 1573
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/libcdio/libcdio-$version.tar.bz2
    cleanup:
      - /bin
  - name: strawberry
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/strawberrymusicplayer/strawberry/releases/download/1.0.0/strawberry-1.0.0.tar.xz
        sha256: 21e1fb70f03450a6b9777d0afb271a7a7922258ebb364c86b8104327496ca7a1
        x-checker-data:
          type: json
          url: https://api.github.com/repos/strawberrymusicplayer/strawberry/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="strawberry-"+ $version +".tar.xz")
            | .browser_download_url
